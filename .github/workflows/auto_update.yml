name: Update All Podcasts

on:
  schedule:
    # 12:00 - 12:30 (HKT) 每 5 分鐘檢查一次
    # UTC 04:00, 04:05, 04:10... 04:30
    - cron: '0,5,10,15,20,25,30 4 * * 1-5'
    
    # 19:00 - 19:30 (HKT) 每 5 分鐘檢查一次
    # UTC 11:00, 11:05, 11:10... 11:30
    - cron: '0,5,10,15,20,25,30 11 * * 1-5'
    
  workflow_dispatch: 

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout code
        uses: actions/checkout@v3
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'
      - name: Install dependencies
        run: pip install requests
      - name: Update Podcasts
        run: |
          python update_podcast.py
          python update_ilub.py
      - name: Commit and Push
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add rss.xml ilub.xml
          git commit -m "Auto-check for new episodes" || exit 0
          git push
